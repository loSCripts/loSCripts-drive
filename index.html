<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Google Drive</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
    <h1>Bienvenue sur l'application Google Drive</h1>
    <button id="signin-button" onclick="authenticate()">Se connecter avec Google</button>
    <button id="signout-button" onclick="signOut()" style="display:none;">Se déconnecter</button>

    <div id="file-list" style="display:none;">
        <h2>Vos fichiers Google Drive</h2>
        <ul id="files"></ul>
    </div>

    <script>
        // ID client OAuth
        const CLIENT_ID = '798204446192-h6uhlhh6pghpnc2lu5kppmp6f1vklhgm.apps.googleusercontent.com';
        
        // Clé API pour Google Drive
        const API_KEY = 'AIzaSyDgCdhwCPXGxC5w_751BfCMKo1Wsr_WE_8';
        
        // Déclarez la portée de l'API
        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';
        
        // Initialisation de l'API client et de l'authentification
        function authenticate() {
            gapi.auth2.getAuthInstance().signIn().then(function() {
                console.log("Utilisateur connecté");
                document.getElementById('signin-button').style.display = 'none';
                document.getElementById('signout-button').style.display = 'block';
                loadClient();
            }).catch(function(error) {
                console.log('Erreur lors de l\'authentification : ', error);
            });
        }
        
        function signOut() {
            gapi.auth2.getAuthInstance().signOut().then(function() {
                console.log("Utilisateur déconnecté");
                document.getElementById('signin-button').style.display = 'block';
                document.getElementById('signout-button').style.display = 'none';
                document.getElementById('file-list').style.display = 'none';
            });
        }
        
        function loadClient() {
            gapi.client.setApiKey(API_KEY);
            gapi.client.load('drive', 'v3', function() {
                console.log("Google Drive API chargée");
                listFiles();
            });
        }

        function listFiles() {
            gapi.client.drive.files.list({
                'pageSize': 10,
                'fields': "nextPageToken, files(id, name)"
            }).then(function(response) {
                const files = response.result.files;
                if (files && files.length > 0) {
                    const fileList = document.getElementById('files');
                    fileList.innerHTML = '';
                    files.forEach(function(file) {
                        let li = document.createElement('li');
                        li.textContent = file.name;
                        fileList.appendChild(li);
                    });
                    document.getElementById('file-list').style.display = 'block';
                } else {
                    console.log('Aucun fichier trouvé.');
                }
            }).catch(function(error) {
                console.log('Erreur lors de la récupération des fichiers : ', error);
            });
        }

        function init() {
            gapi.load('client:auth2', function() {
                gapi.auth2.init({
                    client_id: CLIENT_ID,
                }).then(function() {
                    console.log("Google API initialisée");
                    if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
                        document.getElementById('signin-button').style.display = 'none';
                        document.getElementById('signout-button').style.display = 'block';
                        loadClient();
                    } else {
                        document.getElementById('signin-button').style.display = 'block';
                        document.getElementById('signout-button').style.display = 'none';
                    }
                }).catch(function(error) {
                    console.log('Erreur lors de l\'initialisation de l\'API : ', error);
                });
            });
        }
        
        // Charger l'API dès que la page est prête
        window.onload = init;
    </script>
</body>
</html>
